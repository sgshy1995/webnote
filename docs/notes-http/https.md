---
title: HTTPS总结理解 
---

## 什么是HTTPS

HTTPS是一种协议，是在HTTP的基础上建立SSL加密层，并对传输数据进行加密。广泛用于网络上安全敏感的通讯，比如交易支付方面。

主要作用是：

- 对数据进行加密，建立信息安全通道，来保证传输过程中的数据安全。

- 对网站服务器进行真实身份认证。

## HTTPS的作用

HTTP存在很多弊端：

- 使用明文未加密传输数据，内容可能被窃取

- 无法验证报文的完整性，没有任何办法确认发出的请求/响应和接收到的请求/响应是前后相同的，内容可能被篡改

- 无法验证通信方的身份，可能被伪装成虚拟造假服务器，俗称的钓鱼欺诈

HTTPS对比优势：

- 数据隐私性：内容经过对称加密，每个连接生成一个唯一的加密密钥

- 数据完整性：内容传输完整性校验

- 身份认证：第三方无法伪造服务端（客户端）身份

## HTTPS原理

HTTPS并非是应用层的一种新协议，只是HTTP通信接口部分用SSL和TLS协议代替而已。

通常，HTTP和TCP直接通信。当使用HTTPS时，先和SSL通信，再由SSL和TCP通信。

在采用了SSL后，HTTPS就有了加密、证书和完整性保护功能。**也就是说HTTP加上加密处理以和认证以及完整性保护后就是HTTPS。**

### 加密原理

HTTPS协议的主要功能基本都依赖于TLS/SSL协议，其实现主要依赖于三类基本算法：散列函数、对称加密和非对称加密。

**利用非对称加密实现身份认证和密钥协商，对称加密算法采用协商的密钥对数据加密，基于散列函数验证信息的完整性。**

![加密原理](/images/https_secret.jpg)

### 加密———混合加密

HTTPS采用对称+非对称混合加密。

使用对称加密的好处是解密的效率比较快，使用非对称加密的好处是可以使得传输的内容不被破解，因为就算你拦截到了数据，但是没有对应的私钥，也没有办法破解内容。

**在交换密钥环节使用非对称加密，之后建立的通信交换报文阶段则使用对称加密方式。**

具体做法是：**发送密文的一方使用对方的公钥进行加密处理“对称的密钥”，对方用自己的私钥解密拿到“对称的密钥”，这样可以确保交换的密钥是安全的前提下，使用对称加密方式进行通信。**

### 防篡改———数字签名

数字签名有两种功效：

- 能够确定消息确实是由发送方签名并发出的，别人无法冒充签名

- 能够确认消息的完整性，确认数据没有被篡改

数字签名如何生成：

![数字签名生成](/images/signature_generate.jpg)

将一段文本信息用Hash函数生成消息摘要，然后再用发送者的私钥加密生成数字签名，与原文一起发送给接收者。

数字签名如何校验：

![数字签名校验](/images/signature_check.jpg)

接收者只有使用发送者的公钥才能解密摘要信息，然后用Hash函数对收到的原文产生一个摘要信息，与收到的摘要信息比对。如果相同，则证明收到的信息是完整的，在传输过程中没有被篡改，完整性得以校验。

**证书颁发机构**（Certificate Authority，简称CA）,CA对公钥和其他信息数字签名后生成证书。

### 防止伪装通信方————数字证书

数字证书认证机构处于客户端和服务器双方都可信赖的第三方机构的立场上。

## HTTPS的工作流程

![https工作流程](/images/https_work.jpg)

1、Client发起https请求，默认连接Server的443端口。

2、Server把实现配置好的公钥证书（public key certificate）返回给Client。

3、Client验证公钥证书：比如是否在有效期内，证书用途是否匹配请求站点，是否吊销，是否上级证书有效，递归直到验证到根证书（操作系统内置的Root证书或者Client内置的Root证书）。如果验证通过则继续，没有通过则显示警告信息。

4、Client使用伪随机数生成器生成加密所使用的对称密钥，然后用证书的公钥加密这个对称密钥，发给Server。

5、Server使用自己的私钥（private key）解密消息，得到对称密钥；至此，双方都持有了对称密钥。

6、Server使用对称密钥加密“明文内容A”，发送给Client。

7、Client使用对称密钥解密响应的密文，得到“明文内容A”。

8、Client再次发起https请求，使用对称密钥加密“明文内容B”，然后Server使用对称密钥解密密文，得到“明文内容B”。

## HTTP和HTTPS的区别

- HTTP是明文传输协议，HTTPS协议是由SSL+HTTP协议构建的可加密传输、身份认证的网络协议，更加安全。

- HTTPS的SEO更友好，搜索引擎优先搜索。

- 标准端口不同。

- HTTPS基于传输层，HTTP基于应用层。

- HTTPS在浏览器显示安全锁，HTTP则没有或显示警告。

## 为何不是所有的网站都是用HTTPS

- HTTPS普遍认为性能消耗要大于HTTP，与纯文本通信相比，更消耗内存和CPU；但也可以通过性能优化，证书部署在CDN等优化。

- 证书必不可少。自签名的证书会告警，安全的证书还需要想CA申请和购买。

- 国内的安全意识相对较差。